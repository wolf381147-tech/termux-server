#!/bin/bash

# ä¸»èœå•ç³»ç»Ÿ
# é›†æˆæ‰€æœ‰åŠŸèƒ½æ¨¡å—çš„ç»Ÿä¸€å…¥å£

# é¢œè‰²å®šä¹‰
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# æ˜¾ç¤ºä¸»èœå•
show_main_menu() {
    clear
    echo "=========================================="
    echo "           ğŸš€ Termux æœåŠ¡å™¨é¡¹ç›®"
    echo "=========================================="
    echo "1. ğŸ” SSH æœåŠ¡ç®¡ç†"
    echo "2. ğŸŒ Web æœåŠ¡ç®¡ç†"
    echo "3. ğŸ’¾ å¤‡ä»½å·¥å…·"
    echo "4. ğŸ“Š ç³»ç»ŸçŠ¶æ€"
    echo "5. ğŸšª é€€å‡º"
    echo "=========================================="
}

# SSHæœåŠ¡ç®¡ç†èœå•
show_ssh_menu() {
    clear
    echo "=========================================="
    echo "           ğŸ” SSH æœåŠ¡ç®¡ç†"
    echo "=========================================="
    echo "1. â–¶ï¸  å¯åŠ¨SSHæœåŠ¡"
    echo "2. â–¶ï¸  å¯åŠ¨ä¼˜åŒ–SSHæœåŠ¡ï¼ˆé˜²æ¯å±æ–­è”ï¼‰"
    echo "3. â¹ï¸  åœæ­¢SSHæœåŠ¡"
    echo "4. ğŸ“Š æŸ¥çœ‹SSHçŠ¶æ€"
    echo "5. â„¹ï¸  SSHè¿æ¥ä¿¡æ¯"
    echo "0. â†©ï¸  è¿”å›ä¸»èœå•"
    echo "=========================================="
}

# WebæœåŠ¡ç®¡ç†èœå•
show_web_menu() {
    clear
    echo "=========================================="
    echo "           ğŸŒ Web æœåŠ¡ç®¡ç†"
    echo "=========================================="
    echo "1. â–¶ï¸  å¯åŠ¨WebæœåŠ¡å™¨"
    echo "2. â¹ï¸  åœæ­¢WebæœåŠ¡å™¨"
    echo "3. ğŸ“Š æŸ¥çœ‹WebçŠ¶æ€"
    echo "4. â„¹ï¸  Webè¿æ¥ä¿¡æ¯"
    echo "0. â†©ï¸  è¿”å›ä¸»èœå•"
    echo "=========================================="
}

# å¤‡ä»½å·¥å…·èœå•
show_backup_menu() {
    clear
    echo "=========================================="
    echo "           ğŸ’¾ å¤‡ä»½å·¥å…·"
    echo "=========================================="
    echo "1. ğŸ“¦ é¡¹ç›®å¤‡ä»½"
    echo "2. ğŸ’» ç³»ç»Ÿå¤‡ä»½"
    echo "3. ğŸ—ƒï¸  å®Œæ•´å¤‡ä»½"
    echo "4. ğŸš€ ç»ˆæå¤‡ä»½"
    echo "5. ğŸ“‹ åˆ—å‡ºå¤‡ä»½æ–‡ä»¶"
    echo "6. ğŸ§¹ æ¸…ç†æ—§å¤‡ä»½"
    echo "0. â†©ï¸  è¿”å›ä¸»èœå•"
    echo "=========================================="
}

# å¤„ç†SSHèœå•é€‰é¡¹
handle_ssh_menu() {
    while true; do
        show_ssh_menu
        read -p "è¯·é€‰æ‹©: " ssh_choice
        
        case $ssh_choice in
            1)
                echo -e "${BLUE}å¯åŠ¨SSHæœåŠ¡...${NC}"
                ~/.shortcuts/service-ssh start
                echo -e "${GREEN}âœ… SSHæœåŠ¡å¯åŠ¨å®Œæˆ${NC}"
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            2)
                echo -e "${BLUE}å¯åŠ¨ä¼˜åŒ–SSHæœåŠ¡...${NC}"
                ~/.shortcuts/service-ssh start --optimized
                echo -e "${GREEN}âœ… ä¼˜åŒ–SSHæœåŠ¡å¯åŠ¨å®Œæˆ${NC}"
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            3)
                echo -e "${BLUE}åœæ­¢SSHæœåŠ¡...${NC}"
                ~/.shortcuts/service-ssh stop
                echo -e "${GREEN}âœ… SSHæœåŠ¡å·²åœæ­¢${NC}"
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            4)
                echo -e "${BLUE}æ£€æŸ¥SSHæœåŠ¡çŠ¶æ€...${NC}"
                ~/.shortcuts/service-ssh status
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            5)
                echo -e "${BLUE}æ˜¾ç¤ºSSHè¿æ¥ä¿¡æ¯...${NC}"
                ~/.shortcuts/service-ssh info --with-guide
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡æ–°è¾“å…¥${NC}"
                sleep 1
                ;;
        esac
    done
}

# å¤„ç†Webèœå•é€‰é¡¹
handle_web_menu() {
    while true; do
        show_web_menu
        read -p "è¯·é€‰æ‹©: " web_choice
        
        case $web_choice in
            1)
                echo -e "${BLUE}å¯åŠ¨WebæœåŠ¡å™¨...${NC}"
                ~/.shortcuts/service-web start --type server
                echo -e "${GREEN}âœ… WebæœåŠ¡å™¨å¯åŠ¨å®Œæˆ${NC}"
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            2)
                echo -e "${BLUE}åœæ­¢WebæœåŠ¡å™¨...${NC}"
                ~/.shortcuts/service-web stop --type server
                echo -e "${GREEN}âœ… WebæœåŠ¡å™¨å·²åœæ­¢${NC}"
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            3)
                echo -e "${BLUE}æ£€æŸ¥WebæœåŠ¡çŠ¶æ€...${NC}"
                ~/.shortcuts/service-web status --type server
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            4)
                echo -e "${BLUE}æ˜¾ç¤ºWebè¿æ¥ä¿¡æ¯...${NC}"
                ~/.shortcuts/service-web info --with-guide
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡æ–°è¾“å…¥${NC}"
                sleep 1
                ;;
        esac
    done
}

# å¤„ç†å¤‡ä»½èœå•é€‰é¡¹
handle_backup_menu() {
    while true; do
        show_backup_menu
        read -p "è¯·é€‰æ‹©: " backup_choice
        
        case $backup_choice in
            1)
                echo -e "${BLUE}æ‰§è¡Œé¡¹ç›®å¤‡ä»½...${NC}"
                ~/.shortcuts/tool-backup backup --type project
                echo -e "${GREEN}âœ… é¡¹ç›®å¤‡ä»½å®Œæˆ${NC}"
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            2)
                echo -e "${BLUE}æ‰§è¡Œç³»ç»Ÿå¤‡ä»½...${NC}"
                ~/.shortcuts/tool-backup backup --type system
                echo -e "${GREEN}âœ… ç³»ç»Ÿå¤‡ä»½å®Œæˆ${NC}"
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            3)
                echo -e "${BLUE}æ‰§è¡Œå®Œæ•´å¤‡ä»½...${NC}"
                ~/.shortcuts/tool-backup backup --type full
                echo -e "${GREEN}âœ… å®Œæ•´å¤‡ä»½å®Œæˆ${NC}"
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            4)
                echo -e "${BLUE}æ‰§è¡Œç»ˆæå¤‡ä»½...${NC}"
                ~/.shortcuts/tool-backup backup --type ultimate
                echo -e "${GREEN}âœ… ç»ˆæå¤‡ä»½å®Œæˆ${NC}"
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            5)
                echo -e "${BLUE}åˆ—å‡ºå¤‡ä»½æ–‡ä»¶...${NC}"
                ~/.shortcuts/tool-backup list
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            6)
                echo -e "${BLUE}æ¸…ç†æ—§å¤‡ä»½...${NC}"
                ~/.shortcuts/tool-backup clean
                echo -e "${GREEN}âœ… å¤‡ä»½æ¸…ç†å®Œæˆ${NC}"
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            0)
                return
                ;;
            *)
                echo -e "${RED}æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡æ–°è¾“å…¥${NC}"
                sleep 1
                ;;
        esac
    done
}

# ä¸»ç¨‹åºå¾ªç¯
main() {
    while true; do
        show_main_menu
        read -p "è¯·é€‰æ‹©: " main_choice
        
        case $main_choice in
            1)
                handle_ssh_menu
                ;;
            2)
                handle_web_menu
                ;;
            3)
                handle_backup_menu
                ;;
            4)
                echo -e "${YELLOW}æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€...${NC}"
                if command -v neofetch >/dev/null 2>&1; then
                    neofetch
                else
                    echo "ç³»ç»Ÿä¿¡æ¯:"
                    uname -a
                    echo "ç”¨æˆ·: $(whoami)"
                    echo "å½“å‰ç›®å½•: $(pwd)"
                fi
                read -p "æŒ‰å›è½¦é”®ç»§ç»­..."
                ;;
            5)
                echo -e "${GREEN}æ„Ÿè°¢ä½¿ç”¨ Termux æœåŠ¡å™¨é¡¹ç›®ï¼${NC}"
                exit 0
                ;;
            *)
                echo -e "${RED}æ— æ•ˆé€‰æ‹©ï¼Œè¯·é‡æ–°è¾“å…¥${NC}"
                sleep 1
                ;;
        esac
    done
}

# æ‰§è¡Œä¸»ç¨‹åº
main